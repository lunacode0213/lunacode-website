// ì…ì¶˜ ì‹œê° ë°ì´í„° (1900 ~ 2060)
export const ipchunTimes = {
  1900: { month: 2, day: 4, hour: 17, minute: 40 },
  1901: { month: 2, day: 4, hour: 8, minute: 32 },
  1902: { month: 2, day: 4, hour: 3, minute: 26 },
  1903: { month: 2, day: 4, hour: 8, minute: 7 },
  1904: { month: 2, day: 4, hour: 11, minute: 1 },
  1905: { month: 2, day: 4, hour: 7, minute: 4 },
  1906: { month: 2, day: 3, hour: 11, minute: 49 },
  1907: { month: 2, day: 4, hour: 9, minute: 30 },
  1908: { month: 2, day: 4, hour: 23, minute: 14 },
  1909: { month: 2, day: 4, hour: 7, minute: 3 },
  1910: { month: 2, day: 4, hour: 16, minute: 4 },
  1911: { month: 2, day: 4, hour: 19, minute: 55 },
  1912: { month: 2, day: 4, hour: 16, minute: 53 },
  1913: { month: 2, day: 4, hour: 9, minute: 34 },
  1914: { month: 2, day: 4, hour: 6, minute: 45 },
  1915: { month: 2, day: 4, hour: 19, minute: 32 },
  1916: { month: 2, day: 4, hour: 20, minute: 4 },
  1917: { month: 2, day: 3, hour: 7, minute: 50 },
  1918: { month: 2, day: 4, hour: 14, minute: 18 },
  1919: { month: 2, day: 4, hour: 5, minute: 40 },
  1920: { month: 2, day: 4, hour: 13, minute: 23 },
  1921: { month: 2, day: 4, hour: 3, minute: 29 },
  1922: { month: 2, day: 4, hour: 21, minute: 49 },
  1923: { month: 2, day: 4, hour: 10, minute: 51 },
  1924: { month: 2, day: 4, hour: 8, minute: 29 },
  1925: { month: 2, day: 4, hour: 9, minute: 38 },
  1926: { month: 2, day: 4, hour: 19, minute: 57 },
  1927: { month: 2, day: 4, hour: 5, minute: 41 },
  1928: { month: 2, day: 4, hour: 11, minute: 42 },
  1929: { month: 2, day: 4, hour: 17, minute: 48 },
  1930: { month: 2, day: 4, hour: 9, minute: 5 },
  1931: { month: 2, day: 4, hour: 9, minute: 51 },
  1932: { month: 2, day: 4, hour: 22, minute: 35 },
  1933: { month: 2, day: 3, hour: 13, minute: 43 },
  1934: { month: 2, day: 3, hour: 20, minute: 44 },
  1935: { month: 2, day: 4, hour: 10, minute: 4 },
  1936: { month: 2, day: 4, hour: 13, minute: 56 },
  1937: { month: 2, day: 4, hour: 14, minute: 3 },
  1938: { month: 2, day: 4, hour: 14, minute: 10 },
  1939: { month: 2, day: 4, hour: 12, minute: 22 },
  1940: { month: 2, day: 4, hour: 3, minute: 38 },
  1941: { month: 2, day: 4, hour: 18, minute: 42 },
  1942: { month: 2, day: 4, hour: 8, minute: 2 },
  1943: { month: 2, day: 4, hour: 3, minute: 6 },
  1944: { month: 2, day: 4, hour: 16, minute: 24 },
  1945: { month: 2, day: 4, hour: 15, minute: 45 },
  1946: { month: 2, day: 4, hour: 18, minute: 51 },
  1947: { month: 2, day: 4, hour: 6, minute: 57 },
  1948: { month: 2, day: 4, hour: 8, minute: 17 },
  1949: { month: 2, day: 4, hour: 8, minute: 35 },
  1950: { month: 2, day: 4, hour: 21, minute: 31 },
  1951: { month: 2, day: 3, hour: 19, minute: 52 },
  1952: { month: 2, day: 4, hour: 6, minute: 48 },
  1953: { month: 2, day: 4, hour: 4, minute: 31 },
  1954: { month: 2, day: 4, hour: 5, minute: 47 },
  1955: { month: 2, day: 3, hour: 18, minute: 40 },
  1956: { month: 2, day: 4, hour: 17, minute: 15 },
  1957: { month: 2, day: 4, hour: 7, minute: 39 },
  1958: { month: 2, day: 4, hour: 9, minute: 27 },
  1959: { month: 2, day: 4, hour: 18, minute: 14 },
  1960: { month: 2, day: 4, hour: 12, minute: 2 },
  1961: { month: 2, day: 4, hour: 17, minute: 12 },
  1962: { month: 2, day: 3, hour: 4, minute: 24 },
  1963: { month: 2, day: 4, hour: 23, minute: 33 },
  1964: { month: 2, day: 4, hour: 20, minute: 29 },
  1965: { month: 2, day: 4, hour: 9, minute: 37 },
  1966: { month: 2, day: 4, hour: 9, minute: 48 },
  1967: { month: 2, day: 4, hour: 5, minute: 37 },
  1968: { month: 2, day: 4, hour: 17, minute: 38 },
  1969: { month: 2, day: 4, hour: 11, minute: 52 },
  1970: { month: 2, day: 4, hour: 21, minute: 11 },
  1971: { month: 2, day: 4, hour: 17, minute: 23 },
  1972: { month: 2, day: 4, hour: 13, minute: 49 },
  1973: { month: 2, day: 4, hour: 18, minute: 20 },
  1974: { month: 2, day: 4, hour: 20, minute: 45 },
  1975: { month: 2, day: 3, hour: 5, minute: 18 },
  1976: { month: 2, day: 4, hour: 6, minute: 30 },
  1977: { month: 2, day: 3, hour: 22, minute: 9 },
  1978: { month: 2, day: 4, hour: 10, minute: 42 },
  1979: { month: 2, day: 4, hour: 21, minute: 34 },
  1980: { month: 2, day: 3, hour: 10, minute: 2 },
  1981: { month: 2, day: 4, hour: 8, minute: 21 },
  1982: { month: 2, day: 4, hour: 18, minute: 50 },
  1983: { month: 2, day: 4, hour: 9, minute: 42 },
  1984: { month: 2, day: 4, hour: 15, minute: 38 },
  1985: { month: 2, day: 4, hour: 4, minute: 58 },
  1986: { month: 2, day: 3, hour: 15, minute: 7 },
  1987: { month: 2, day: 4, hour: 3, minute: 0 },
  1988: { month: 2, day: 4, hour: 7, minute: 41 },
  1989: { month: 2, day: 3, hour: 7, minute: 15 },
  1990: { month: 2, day: 4, hour: 7, minute: 51 },
  1991: { month: 2, day: 4, hour: 21, minute: 53 },
  1992: { month: 2, day: 3, hour: 20, minute: 49 },
  1993: { month: 2, day: 4, hour: 6, minute: 1 },
  1994: { month: 2, day: 4, hour: 8, minute: 49 },
  1995: { month: 2, day: 4, hour: 11, minute: 5 },
  1996: { month: 2, day: 4, hour: 5, minute: 37 },
  1997: { month: 2, day: 4, hour: 19, minute: 52 },
  1998: { month: 2, day: 4, hour: 6, minute: 36 },
  1999: { month: 2, day: 4, hour: 18, minute: 10 },
  2000: { month: 2, day: 4, hour: 16, minute: 16 },
  2001: { month: 2, day: 4, hour: 22, minute: 16 },
  2002: { month: 2, day: 4, hour: 8, minute: 44 },
  2003: { month: 2, day: 4, hour: 6, minute: 7 },
  2004: { month: 2, day: 4, hour: 5, minute: 28 },
  2005: { month: 2, day: 4, hour: 16, minute: 46 },
  2006: { month: 2, day: 3, hour: 22, minute: 12 },
  2007: { month: 2, day: 4, hour: 5, minute: 45 },
  2008: { month: 2, day: 4, hour: 19, minute: 38 },
  2009: { month: 2, day: 4, hour: 14, minute: 19 },
  2010: { month: 2, day: 4, hour: 16, minute: 22 },
  2011: { month: 2, day: 4, hour: 3, minute: 30 },
  2012: { month: 2, day: 4, hour: 12, minute: 49 },
  2013: { month: 2, day: 4, hour: 4, minute: 57 },
  2014: { month: 2, day: 4, hour: 19, minute: 5 },
  2015: { month: 2, day: 4, hour: 10, minute: 13 },
  2016: { month: 2, day: 4, hour: 6, minute: 22 },
  2017: { month: 2, day: 4, hour: 6, minute: 34 },
  2018: { month: 2, day: 4, hour: 9, minute: 32 },
  2019: { month: 2, day: 4, hour: 19, minute: 36 },
  2020: { month: 2, day: 4, hour: 19, minute: 32 },
  2021: { month: 2, day: 4, hour: 11, minute: 51 },
  2022: { month: 2, day: 4, hour: 20, minute: 23 },
  2023: { month: 2, day: 4, hour: 13, minute: 39 },
  2024: { month: 2, day: 4, hour: 19, minute: 57 },
  2025: { month: 2, day: 3, hour: 19, minute: 34 },
  2026: { month: 2, day: 4, hour: 23, minute: 17 },
  2027: { month: 2, day: 4, hour: 8, minute: 4 },
  2028: { month: 2, day: 4, hour: 12, minute: 49 },
  2029: { month: 2, day: 4, hour: 3, minute: 55 },
  2030: { month: 2, day: 4, hour: 5, minute: 5 },
  2031: { month: 2, day: 4, hour: 6, minute: 58 },
  2032: { month: 2, day: 4, hour: 8, minute: 17 },
  2033: { month: 2, day: 4, hour: 15, minute: 11 },
  2034: { month: 2, day: 4, hour: 17, minute: 31 },
  2035: { month: 2, day: 4, hour: 13, minute: 31 },
  2036: { month: 2, day: 4, hour: 20, minute: 24 },
  2037: { month: 2, day: 4, hour: 23, minute: 11 },
  2038: { month: 2, day: 4, hour: 15, minute: 26 },
  2039: { month: 2, day: 4, hour: 23, minute: 5 },
  2040: { month: 2, day: 4, hour: 5, minute: 18 },
  2041: { month: 2, day: 4, hour: 13, minute: 30 },
  2042: { month: 2, day: 4, hour: 12, minute: 36 },
  2043: { month: 2, day: 4, hour: 10, minute: 1 },
  2044: { month: 2, day: 4, hour: 15, minute: 55 },
  2045: { month: 2, day: 4, hour: 15, minute: 27 },
  2046: { month: 2, day: 4, hour: 9, minute: 54 },
  2047: { month: 2, day: 4, hour: 20, minute: 27 },
  2048: { month: 2, day: 4, hour: 17, minute: 35 },
  2049: { month: 2, day: 4, hour: 5, minute: 29 },
  2050: { month: 2, day: 4, hour: 7, minute: 19 },
  2051: { month: 2, day: 4, hour: 16, minute: 7 },
  2052: { month: 2, day: 4, hour: 6, minute: 56 },
  2053: { month: 2, day: 4, hour: 12, minute: 50 },
  2054: { month: 2, day: 3, hour: 12, minute: 21 },
  2055: { month: 2, day: 4, hour: 5, minute: 29 },
  2056: { month: 2, day: 4, hour: 8, minute: 46 },
  2057: { month: 2, day: 4, hour: 6, minute: 46 },
  2058: { month: 2, day: 3, hour: 9, minute: 1 },
  2059: { month: 2, day: 4, hour: 22, minute: 16 },
  2060: { month: 2, day: 4, hour: 12, minute: 43 },
};


// ğŸŒ™ ì‚¬ì£¼ ê°„ì§€ ê³„ì‚°ìš© JS í•¨ìˆ˜ë“¤

// 60ê°„ì§€ ìˆœì„œ ë°°ì—´
export const ganji60 = [
  "ç”²å­", "ä¹™ä¸‘", "ä¸™å¯…", "ä¸å¯", "æˆŠè¾°", "å·±å·³", "åºšåˆ", "è¾›æœª", "å£¬ç”³", "ç™¸é…‰",
  "ç”²æˆŒ", "ä¹™äº¥", "ä¸™å­", "ä¸ä¸‘", "æˆŠå¯…", "å·±å¯", "åºšè¾°", "è¾›å·³", "å£¬åˆ", "ç™¸æœª",
  "ç”²ç”³", "ä¹™é…‰", "ä¸™æˆŒ", "ä¸äº¥", "æˆŠå­", "å·±ä¸‘", "åºšå¯…", "è¾›å¯", "å£¬è¾°", "ç™¸å·³",
  "ç”²åˆ", "ä¹™æœª", "ä¸™ç”³", "ä¸é…‰", "æˆŠæˆŒ", "å·±äº¥", "åºšå­", "è¾›ä¸‘", "å£¬å¯…", "ç™¸å¯",
  "ç”²è¾°", "ä¹™å·³", "ä¸™åˆ", "ä¸æœª", "æˆŠç”³", "å·±é…‰", "åºšæˆŒ", "è¾›äº¥", "å£¬å­", "ç™¸ä¸‘",
  "ç”²å¯…", "ä¹™å¯", "ä¸™è¾°", "ä¸å·³", "æˆŠåˆ", "å·±æœª", "åºšç”³", "è¾›é…‰", "å£¬æˆŒ", "ç™¸äº¥"
];

// ì—°ì£¼ ê³„ì‚° (2ì›” 4ì¼ ì´ì „ì´ë©´ ì „ë…„ë„ ê°„ì§€ ì‚¬ìš©)
export function getYearGanji(year, month, day) {
  const gan = ["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"];
  const ji = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
  const ganjiIndex = (year - 4) % 60;
  const ganIndex = ganjiIndex % 10;
  const jiIndex = ganjiIndex % 12;

  if (month < 2 || (month === 2 && day < 4)) {
    const prevIndex = (ganjiIndex + 59) % 60;
    return [gan[prevIndex % 10], ji[prevIndex % 12]];
  }

  return [gan[ganIndex], ji[jiIndex]];
}

// ì ˆì…ì¼ ê¸°ì¤€ ì›”ì£¼
const ipjeolTable = {
  1: 6, 2: 4, 3: 6, 4: 5, 5: 5, 6: 6,
  7: 7, 8: 7, 9: 8, 10: 8, 11: 7, 12: 7
};

export function getMonthGanji(yearGan, month, day) {
  const gan = ["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"];
  const ji = ["å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥","å­","ä¸‘"];
  const baseMonthGan = ["ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸", "ç”²", "ä¹™", "ä¸™", "ä¸"];

  const offset = gan.indexOf(yearGan);
  const rotated = baseMonthGan.slice(offset).concat(baseMonthGan.slice(0, offset));

  let useMonth = month;
  if (day < (ipjeolTable[month] || 6)) {
    useMonth -= 1;
    if (useMonth === 0) useMonth = 12;
  }

  return [rotated[useMonth - 1], ji[useMonth - 1]];
}

// ì¼ì£¼ ê³„ì‚°
export function getDayGanjiIndex(year, month, day) {
  const baseDate = new Date(1900, 0, 1);
  const current = new Date(year, month - 1, day);
  const daysDiff = Math.floor((current - baseDate) / (1000 * 60 * 60 * 24));
  return daysDiff % 60;
}

export function getDayGanji(index) {
  const gan = ["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"];
  const ji = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
  return [gan[index % 10], ji[index % 12]];
}

// ì‹œì£¼ ê³„ì‚° (ì…ë ¥ê°’ ê·¸ëŒ€ë¡œ, ë³´ì • ì œê±° ì™„ë£Œ)
const timeTable = [
  { from: 2330, to: 129, zhi: "å­" },
  { from: 130, to: 329, zhi: "ä¸‘" },
  { from: 330, to: 529, zhi: "å¯…" },
  { from: 530, to: 729, zhi: "å¯" },
  { from: 730, to: 929, zhi: "è¾°" },
  { from: 930, to: 1129, zhi: "å·³" },
  { from: 1130, to: 1329, zhi: "åˆ" },
  { from: 1330, to: 1529, zhi: "æœª" },
  { from: 1530, to: 1729, zhi: "ç”³" },
  { from: 1730, to: 1929, zhi: "é…‰" },
  { from: 1930, to: 2129, zhi: "æˆŒ" },
  { from: 2130, to: 2329, zhi: "äº¥" }
];

export function getHourGanji(dayStem, hour, minute) {
  // ë³´ì • ì œê±°: ì…ë ¥ ìì²´ê°€ ë³´ì •ëœ ê°’ì´ê¸° ë•Œë¬¸ì— ê·¸ëŒ€ë¡œ ì‚¬ìš©
  const timeVal = hour * 100 + minute;

  let zhi = "å­";
  for (let entry of timeTable) {
    if (
      (entry.from <= entry.to && timeVal >= entry.from && timeVal <= entry.to) ||
      (entry.from > entry.to && (timeVal >= entry.from || timeVal <= entry.to))
    ) {
      zhi = entry.zhi;
      break;
    }
  }

  return [dayStem, zhi]; // ì‹œê°„ì€ ì¼ê°„ ê¸°ì¤€ ì‹œê°„í‘œë¡œ ê²°ì • (í›„ì† êµ¬í˜„ í•„ìš”)
}


// ì…ì¶˜ ê¸°ì¤€ ë°˜ì˜í•œ ì—°ì£¼ ê³„ì‚°
export function getYearGanjiAccurate(year, month, day, hour, minute) {
  const ip = ipchunTimes[year];
  if (!ip) return getYearGanji(year, month, day); // fallback

  const inputTime = new Date(year, month - 1, day, hour, minute);
  const ipchunTime = new Date(year, ip.month - 1, ip.day, ip.hour, ip.minute);

  if (inputTime < ipchunTime) {
    return getYearGanji(year - 1, 12, 31); // ì „ë…„ë„ ê°„ì§€ ì‚¬ìš©
  }
  return getYearGanji(year, month, day);
}
